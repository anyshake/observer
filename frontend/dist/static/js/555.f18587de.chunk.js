"use strict";(self.webpackChunkobserver=self.webpackChunkobserver||[]).push([[555],{5608:function(e,t,n){var r=n(5671),a=n(3144),s=n(136),o=n(9388),i=n(7313),c=n(5590),l=n(6417),u=function(e){(0,s.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.t,n=e.children,r=e.label,a=e.text;return(0,l.jsxs)("div",{className:"mb-4 flex flex-col rounded-xl text-gray-700 shadow-lg",children:[(0,l.jsx)("div",{className:"mx-4 rounded-lg overflow-hidden shadow-lg",children:n}),(0,l.jsxs)("div",{className:"p-4",children:[(0,l.jsx)("h6",{className:"text-md font-bold text-gray-800",children:t(r.id,r.format)}),a&&(0,l.jsx)("span",{className:"text-md",children:t(a.id,a.format).split("\n").map((function(e,t){return(0,l.jsxs)("p",{children:[e,(0,l.jsx)("br",{})]},t)}))})]})]})}}]),n}(i.Component);t.Z=(0,c.Zh)()(u)},4595:function(e,t,n){var r=n(5671),a=n(3144),s=n(136),o=n(9388),i=n(7313),c=n(5590),l=n(6417),u=function(e){(0,s.Z)(n,e);var t=(0,o.Z)(n);function n(e){var a;return(0,r.Z)(this,n),(a=t.call(this,e)).state={isBusy:!1},a}return(0,a.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.t,n=e.className,r=e.label,a=e.onClick;return(0,l.jsx)("button",{className:"w-full text-white font-medium text-sm shadow-lg rounded-lg py-2 ".concat(n),onClick:a,children:t(r.id,r.format)})}}]),n}(i.Component);t.Z=(0,c.Zh)()(u)},3387:function(e,t,n){var r=n(5671),a=n(3144),s=n(136),o=n(9388),i=n(7313),c=n(5590),l=n(6417),u=function(e){(0,s.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.t,n=e.className,r=e.label,a=e.sublabel,s=e.children,o=Array.isArray(s)?s:[s];return(0,l.jsx)("div",{className:"w-full h-full text-gray-800",children:(0,l.jsxs)("div",{className:"flex flex-col shadow-lg rounded-lg",children:[(0,l.jsxs)("div",{className:"px-4 py-3 font-bold",children:[a&&(0,l.jsx)("h6",{className:"text-gray-500 text-xs",children:t(a.id,a.format)}),(0,l.jsx)("h2",{className:"text-xl",children:t(r.id,r.format)})]}),(0,l.jsx)("div",{className:"p-4 m-2 flex flex-col justify-center gap-4 ".concat(n),children:o.map((function(e,t){return(0,l.jsx)("div",{children:e},t)}))})]})})}}]),n}(i.Component);t.Z=(0,c.Zh)()(u)},3676:function(e,t,n){var r=n(1413),a=n(5671),s=n(3144),o=n(136),i=n(9388),c=n(7313),l=n(5845),u=n(7548),h=n(1259),d=n.n(h),p=n(5590),f=n(6417);d()(l);var v=function(e){(0,o.Z)(n,e);var t=(0,i.Z)(n);function n(e){var r;(0,a.Z)(this,n);var s=(r=t.call(this,e)).props,o=s.height,i=s.legend,c=s.tooltip,l=s.zooming,u=s.animation,h=s.lineWidth,d=s.tickInterval,p=s.tickPrecision,f=s.lineColor,v=s.backgroundColor;return r.state={accessibility:{enabled:!1},boost:{enabled:!0,seriesThreshold:5},chart:{zooming:l?{type:"x"}:{},marginTop:20,height:o,animation:u,backgroundColor:v},legend:{enabled:i,itemStyle:{color:"#fff"}},plotOptions:{series:{states:{hover:{enabled:!1}},lineWidth:h}},xAxis:{labels:{style:{color:"#fff"},format:"{value:%H:%M:%S}"},type:"datetime",tickColor:"#fff",lineColor:f},yAxis:{labels:{style:{color:"#fff"},format:p?"{value:".concat(p,"f}"):"{value:0.2f}"},title:{text:""},opposite:!0,lineColor:f,tickInterval:d},tooltip:{enabled:c,followPointer:!0,followTouchMove:!0,xDateFormat:"%Y-%m-%d %H:%M:%S",padding:12},credits:{enabled:!1},time:{useUTC:!1},title:{text:""}},r}return(0,s.Z)(n,[{key:"componentDidUpdate",value:function(){var e=this.props.t;l.setOptions({lang:{resetZoom:e("components.chart.reset_zoom"),resetZoomTitle:e("components.chart.reset_zoom_title")}})}},{key:"render",value:function(){var e=this.props.series,t=this.state;if(e.data)e.data.sort((function(e,t){return e[0]-t[0]}));else if(e.length)for(var n=0,a=e;n<a.length;n++){a[n].data.sort((function(e,t){return e[0]-t[0]}))}return(0,f.jsx)(u.HighchartsReact,{options:(0,r.Z)((0,r.Z)({},t),{},{series:e}),highcharts:l})}}]),n}(c.Component);t.Z=(0,p.Zh)()(v)},1653:function(e,t,n){var r=n(5671),a=n(3144),s=n(136),o=n(9388),i=n(7313),c=n(5590),l=n(6417),u=function(e){(0,s.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.t,n=e.className,r=e.icon,a=e.label,s=e.value,o=e.unit,i=e.color;return(0,l.jsx)("div",{className:"w-full p-2 ".concat(n),children:(0,l.jsxs)("div",{className:"flex flex-row bg-gradient-to-r rounded-md p-4 shadow-xl ".concat(i?"from-indigo-500 via-purple-500 to-pink-500":"bg-slate-50 hover:bg-slate-100"),children:[r&&(0,l.jsx)("img",{className:"bg-white p-2 rounded-md w-8 h-8 md:w-12 md:h-12 self-center",src:r,alt:""}),(0,l.jsxs)("div",{className:"flex flex-col flex-grow ".concat(r&&"ml-5"),children:[(0,l.jsx)("div",{className:"text-sm whitespace-nowrap ".concat(i?"text-gray-50":"text-gray-600"),children:t(a.id,a.format)}),(0,l.jsx)("div",{className:"text-md font-medium flex-nowrap ".concat(i?"text-gray-100":"text-gray-800"),children:"".concat(s," ").concat(t(o.id,o.format))})]})]})})}}]),n}(i.Component);t.Z=(0,c.Zh)()(u)},2848:function(e,t,n){var r=n(5671),a=n(3144),s=n(136),o=n(9388),i=n(4469),c=n(3604),l=n(7216),u=n(9840),h=n(3213),d=n(7313),p=n(5590),f=n(6417),v=function(e){(0,s.Z)(n,e);var t=(0,o.Z)(n);function n(){return(0,r.Z)(this,n),t.apply(this,arguments)}return(0,a.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.t,n=e.title,r=e.open,a=e.values,s=e.onClose,o=e.onSelect;return(0,f.jsxs)(i.Z,{onClose:s,open:r,children:[(0,f.jsx)(c.Z,{children:t(n.id,n.format)}),a.map((function(e,t){return(0,f.jsx)(l.ZP,{disableGutters:!0,children:(0,f.jsx)(u.Z,{onClick:function(){return o&&o(e[1])},children:(0,f.jsx)(h.Z,{primary:e[0],secondary:e[3]?e[3]:e[1]})})},t)}))]})}}]),n}(d.Component);t.Z=(0,p.Zh)()(v)},1677:function(e,t){t.Z=[{tag:"station",type:"http",method:"get",uri:"/station"},{tag:"history",type:"http",method:"post",uri:"/history"},{tag:"trace",type:"http",method:"post",uri:"/trace"},{tag:"mseed",type:"http",method:"post",uri:"/mseed"},{tag:"socket",type:"ws",uri:"/socket"}]},281:function(e,t,n){var r=n(1677),a=n(5827);t.Z=function(e){var t,n=a.Z.api_settings,s=n.version,o=n.prefix,i=null===(t=r.Z.find((function(t){return t.tag===e})))||void 0===t?void 0:t.uri;return"".concat(o,"/").concat(s).concat(i)}},7598:function(e,t){t.Z=function(e,t,n,r){if(!e.length)return[];for(var a,s,o=e.length,i=0;i<o-1;i++)for(var c=0;c<o-i-1;c++)if(a=e[c],s=e[c+1],("desc"===r?"datetime"===n?new Date(s[t]).getTime()-new Date(a[t]).getTime():s[t]-a[t]:"datetime"===n?new Date(a[t]).getTime()-new Date(s[t]).getTime():a[t]-s[t])>0){var l=e[c];e[c]=e[c+1],e[c+1]=l}return e}},2468:function(e,t,n){var r=n(4165),a=n(5861),s=n(6573),o=n(2968),i=n(1677),c=n(1061),l=n(281),u=n(8585),h=n.n(u),d=n(5827),p=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,u,p,f,v,m,Z,y,g,x,b,w,k,j,_,C,S,N,M,T,P,z,E,H,D,F;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.tag,u=t.header,p=t.body,f=t.blob,v=t.filename,m=t.onUpload,Z=t.onDownload,y=t.cancelToken,g=t.timeout,x=void 0===g?d.Z.app_settings.timeout:g,(b=s.Z.create({timeout:1e3*x})).interceptors.request.use((function(e){return f||(e.headers.Accept="application/json"),e})),b.interceptors.response.use((function(e){return e}),(function(e){return Promise.reject(e)})),w=(0,l.Z)(a),k=null===(n=i.Z.find((function(e){return e.tag===a})))||void 0===n?void 0:n.method,e.prev=6,"ws"!==(null===(j=i.Z.find((function(e){return e.tag===a})))||void 0===j?void 0:j.type)){e.next=10;break}throw new Error("websocket protocol is not supported");case 10:return _="".concat(window.location.protocol).concat((0,c.Z)()),e.next=13,b.request({data:p,method:k,headers:u,url:"".concat(_).concat(w),onUploadProgress:m,onDownloadProgress:Z,cancelToken:null===y||void 0===y?void 0:y.token,responseType:f?"blob":"json"});case 13:if(C=e.sent,S=C.data,N=C.headers,!f){e.next=21;break}return(M=N["content-disposition"])?(P=null===(T=M.split(";").find((function(e){return e.includes("filename=")})))||void 0===T?void 0:T.split("=")[1])?h()(S,P):h()(S,"stream"):v?h()(S,v):h()(S,"stream"),z=(new Date).toISOString(),e.abrupt("return",{time:z,path:w,data:null,error:!1,status:200,message:"Returned data is a blob"});case 21:return e.abrupt("return",S);case 24:return e.prev=24,e.t0=e.catch(6),E=(new Date).toISOString(),H=e.t0,D=H.message,F=H.status,e.abrupt("return",{time:E,message:D,path:w,data:null,error:!(0,o.Mw)(e.t0),status:F||500});case 29:case"end":return e.stop()}}),e,null,[[6,24]])})));return function(t){return e.apply(this,arguments)}}();t.Z=p},5664:function(e,t){t.Z=function(e,t){for(var n=[],r=0;r<e.length;r++)r?n.push((e[r]-e[r-1])/t):n.push(0);return n}},3148:function(e,t,n){var r=n(7762);t.Z=function(e,t){var n,a=[],s=(0,r.Z)(e);try{for(s.s();!(n=s.n()).done;){var o=n.value;a.push(o/t)}}catch(i){s.e(i)}finally{s.f()}return a}},8715:function(e,t,n){var r=n(7762);t.Z=function(e,t,n){var a,s=Math.pow(2,t-1),o=[],i=(0,r.Z)(e);try{for(i.s();!(a=i.n()).done;){var c=a.value;o.push(n/s*c)}}catch(l){i.e(l)}finally{i.f()}return o}},9350:function(e,t){t.Z=function(e){var t=new Date(e),n=t.getFullYear(),r=(t.getMonth()+1).toString().padStart(2,"0"),a=t.getDate().toString().padStart(2,"0"),s=t.getHours().toString().padStart(2,"0"),o=t.getMinutes().toString().padStart(2,"0"),i=t.getSeconds().toString().padStart(2,"0");return"".concat(n,"-").concat(r,"-").concat(a," ").concat(s,":").concat(o,":").concat(i)}},7912:function(e,t,n){var r=n(9439);t.Z=function(e,t,n){for(var a,s=e,o=t.split(">"),i=function(){var t=o[c];try{if(t.includes("[")||t.includes("]")){var n,a,i=(null===(n=t.match(/^(.*?)\[/))||void 0===n?void 0:n[1])||"",l=(null===(a=t.match(/\[(.*?)\]/))||void 0===a?void 0:a[1])||":";if(!l.length)throw new Error("invalid path given");var u=l.split(":"),h=(0,r.Z)(u,2),d=h[0],p=h[1];s=i.length?s[i].find((function(e){return e[d]===p})):s.find((function(e){return e[d]===p}))}else s=s[t]}catch(f){return{v:e}}},c=0;c<o.length-1;c++)if(a=i())return a.v;var l=o[o.length-1];return s[l]=n,e}},3152:function(e,t){t.Z=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return function(){for(var r=this,a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];clearTimeout(t),t=setTimeout((function(){e.apply(r,s)}),n)}}},6555:function(e,t,n){n.r(t),n.d(t,{default:function(){return Te}});var r=n(4165),a=n(5861),s=n(1413),o=n(5671),i=n(3144),c=n(136),l=n(9388),u=n(7313),h=n(3670),d=n(8669),p=n(5097),f=n(501),v=n(4656),m=n(284),Z=n(19),y=n(3208),g=n(9190),x=n(7114),b=n(3358),w=n(8658),k=n(6396),j=n(4199),_=n(2370),C=n(9515),S=n(2806),N=n(7623),M=n(3605),T=n(5298),P=n(2165),z=n(8768),E=n(1560),H=n(549),D=n(5590),F=n(6417),W={"zh-CN":{theme:j.U,adapterLocale:M.Z},"zh-TW":{theme:_.e,adapterLocale:T.Z},"en-US":{theme:C._,adapterLocale:P.Z},"ja-JP":{theme:S.j,adapterLocale:z.Z},"ko-KR":{theme:N.u,adapterLocale:E.Z}},A=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(){return(0,o.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.t,n=e.label,r=e.onChange,a=e.value,s=e.defaultValue,o=Intl.DateTimeFormat().resolvedOptions().timeZone,i=(0,H.Z)(),c=(0,w.Z)({},W[i].theme);return(0,F.jsx)(k.Z,{theme:c,children:(0,F.jsx)(y._,{dateAdapter:b.H,adapterLocale:W[i].adapterLocale,children:(0,F.jsx)(g.x,{format:"yyyy-MM-dd HH:mm:ss",className:"w-full",timezone:"system",views:["year","month","day","hours","minutes","seconds"],viewRenderers:{hours:x.M6,minutes:x.M6,seconds:x.M6},onChange:function(e){var t=null===e||void 0===e?void 0:e.valueOf();r(t)},slotProps:{field:{clearable:!0}},label:"".concat(t(n.id,n.format)," - ").concat(o),defaultValue:s,value:a,ampm:!1})})})}}]),n}(u.Component),Q=(0,D.Zh)()(A),U=n(3387),L=n(4595),q=n(1109),I=n(3676),O=n(2468),V=n(6059),G=n(2848),R=function(e){var t=e.data.geophone;return{ehz:t.ehz,ehe:t.ehe,ehn:t.ehn}},Y=function(e){var t=e.data.adc;return{resolution:t.resolution,fullscale:t.fullscale}},B=n(4469),J=n(5908),K=n(9289),X=n(1113),$=n(1095),ee=n(8310),te=n(7216),ne=n(9840),re=n(3213),ae=n(9536),se=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(){return(0,o.Z)(this,n),t.apply(this,arguments)}return(0,i.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.t,n=e.title,r=e.open,a=e.values,s=e.onClose,o=e.onSelect;return(0,F.jsxs)(B.Z,{fullWidth:!0,open:r,children:[(0,F.jsx)(J.Z,{className:"bg-purple-500",sx:{position:"relative"},children:(0,F.jsxs)(K.Z,{children:[(0,F.jsx)(X.Z,{sx:{ml:2,flex:1},variant:"h6",children:t(n.id,n.format)}),(0,F.jsx)($.Z,{autoFocus:!0,color:"inherit",onClick:s,children:"X"})]})}),(0,F.jsx)(ee.Z,{children:a.map((function(e,t){return(0,F.jsxs)("div",{children:[(0,F.jsx)(te.ZP,{children:(0,F.jsx)(ne.Z,{onClick:function(){return o&&o(e[1])},children:(0,F.jsx)(re.Z,{primary:e[0],secondary:(0,F.jsx)(F.Fragment,{children:e[2]?e[2].split("\n").map((function(e,t){return(0,F.jsxs)("span",{children:[e,(0,F.jsx)("br",{})]},t)})):e[1].split("\n").map((function(e,t){return(0,F.jsxs)("span",{children:[e,(0,F.jsx)("br",{})]},t)}))})})})}),(0,F.jsx)(ae.Z,{})]},t)}))})]})}}]),n}(u.Component),oe=(0,D.Zh)()(se),ie=n(9350),ce=n(1653),le=n(3433),ue=n(7762),he=n(5664),de=n(7598),pe=n(3148),fe=n(8715),ve=n(7912),me=n(5827),Ze=function(e,t,n,r,a){var s,o=r.ehz,i=r.ehe,c=r.ehn,l=n.fullscale,u=n.resolution,h=[],d=[],p=[],f=[],v=[],m=[],Z=[],y=[],g=[],x=(0,de.Z)(t,"ts","number","asc"),b=(x[x.length-1].ts-x[0].ts)/1e3,w=0,k=(0,ue.Z)(t);try{for(k.s();!(s=k.n()).done;){var j=s.value;h.push.apply(h,(0,le.Z)((0,fe.Z)(j.ehz,u,l))),d.push.apply(d,(0,le.Z)((0,fe.Z)(j.ehe,u,l))),p.push.apply(p,(0,le.Z)((0,fe.Z)(j.ehn,u,l))),w+=(j.ehz.length+j.ehe.length+j.ehn.length)/3}}catch(E){k.e(E)}finally{k.f()}w/=b,f.push.apply(f,(0,le.Z)((0,pe.Z)(h,o))),v.push.apply(v,(0,le.Z)((0,pe.Z)(d,i))),m.push.apply(m,(0,le.Z)((0,pe.Z)(p,c)));var _=1/w;Z.push.apply(Z,(0,le.Z)((0,he.Z)(f,_))),y.push.apply(y,(0,le.Z)((0,he.Z)(v,_))),g.push.apply(g,(0,le.Z)((0,he.Z)(m,_)));var C=f.reduce((function(e,t){var n=Math.abs(e),r=Math.abs(t);return Math.max(n,r)}),0),S=v.reduce((function(e,t){var n=Math.abs(e),r=Math.abs(t);return Math.max(n,r)}),0),N=m.reduce((function(e,t){var n=Math.abs(e),r=Math.abs(t);return Math.max(n,r)}),0),M=Z.reduce((function(e,t){var n=Math.abs(e),r=Math.abs(t);return Math.max(n,r)}),0),T=y.reduce((function(e,t){var n=Math.abs(e),r=Math.abs(t);return Math.max(n,r)}),0),P=g.reduce((function(e,t){var n=Math.abs(e),r=Math.abs(t);return Math.max(n,r)}),0),z=me.Z.app_settings.scales.find((function(e){return e.property().value===a.value}));return(0,ve.Z)(e,"[tag:ehz-pga]>value",M.toFixed(2)),(0,ve.Z)(e,"[tag:ehz-intensity]>value","".concat(a.value," ").concat(null===z||void 0===z?void 0:z.intensity(C,M))),(0,ve.Z)(e,"[tag:ehe-pga]>value",T.toFixed(2)),(0,ve.Z)(e,"[tag:ehe-intensity]>value","".concat(a.value," ").concat(null===z||void 0===z?void 0:z.intensity(S,T))),(0,ve.Z)(e,"[tag:ehn-pga]>value",P.toFixed(2)),(0,ve.Z)(e,"[tag:ehn-intensity]>value","".concat(a.value," ").concat(null===z||void 0===z?void 0:z.intensity(N,P))),e},ye=n(7703),ge=n(8146),xe=n(6135),be=n(8780),we=n(5608),ke=function(e,t){for(var n=(0,de.Z)(t,"ts","number","asc"),r=0,a=["ehz","ehe","ehn"];r<a.length;r++){var s,o=a[r],i=0,c=[],l=(0,ue.Z)(n);try{for(l.s();!(s=l.n()).done;){for(var u=s.value,h=u[o],d=h.length,p=(0!==i?i-u.ts:1e3)/d,f=0;f<h.length;f++)c.push([u.ts+f*p,h[f]]);i=u.ts}}catch(v){l.e(v)}finally{l.f()}(0,ve.Z)(e,"[tag:".concat(o,"]>chart>series>data"),c)}return e},je=n(9439),_e=function(){var e=window.location,t=e.hash,n=e.search,r="hash"===me.Z.app_settings.router?t.split("?")[1]:n.split("?")[1];if(r){var a,s=r.split("&"),o={},i=(0,ue.Z)(s);try{for(i.s();!(a=i.n()).done;){var c=a.value.split("="),l=(0,je.Z)(c,2),u=l[0],h=l[1];o[u]=h}}catch(d){i.e(d)}finally{i.f()}return o}return{}},Ce=n(3250),Se=n(6573),Ne=n(3152),Me=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,o.Z)(this,n),(i=t.call(this,e)).promisedSetState=function(e){return new Promise((function(t){return i.setState(e,t)}))},i.handleTimeChange=function(e,t){switch(e){case"start":i.setState((function(e){return{history:(0,s.Z)((0,s.Z)({},e.history),{},{start:t})}}));break;case"end":i.setState((function(e){return{history:(0,s.Z)((0,s.Z)({},e.history),{},{end:t})}}))}},i.handleQueryHistory=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,a,s,o,c,l,u,h,d,p,f,v,m,Z;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.state.history,n=t.start,a=t.end,s=t.format,o=t.channel,!(a-n<=0)&&n&&a){e.next=7;break}return c=i.props.t,l=c("views.history.toasts.time_error"),V.ZP.error(l),e.abrupt("return",Promise.reject(l));case 7:return u=i.state.tokens,h=Se.Z.CancelToken.source,d=h(),u.push(d),e.next=13,(0,O.Z)({cancelToken:d,body:t,tag:"history",blob:"sac"===s,filename:"".concat(o,"_").concat(n,"_").concat(a,".").concat(s)});case 13:if(p=e.sent,f=p.error,v=p.data,!f){e.next=21;break}return m=i.props.t,Z=m("sac"===s?"views.history.toasts.export_sac_error":"views.history.toasts.fetch_waveform_error"),"sac"===s&&V.ZP.error(Z),e.abrupt("return",Promise.reject(Z));case 21:return e.abrupt("return",v);case 22:case"end":return e.stop()}}),e)}))),i.handleQueryEvents=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,a,o,c,l,u,h;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.state,n=t.tokens,a=t.trace,o=Se.Z.CancelToken.source,c=o(),n.push(c),e.next=6,(0,O.Z)({cancelToken:c,body:a,tag:"trace"});case 6:if(l=e.sent,u=l.error,h=l.data,!u){e.next=11;break}return e.abrupt("return",Promise.reject(u));case 11:i.setState((function(e){return{modal:(0,s.Z)((0,s.Z)({},e.modal),{},{open:!0,values:h.map((function(e){var t=e.magnitude,n=e.region,r=e.event,a=e.timestamp,s=e.depth,o=e.estimated,c=(0,i.props.t)("views.history.modals.choose_event.template",{event:r,time:(0,ie.Z)(a),magnitude:t.toFixed(1),estimated:o.toFixed(1),depth:-1!==s?s.toFixed(1):"Unknown"});return[n,a+1e3*o,c]}))})}}));case 12:case"end":return e.stop()}}),e)}))),i.handleChooseEvent=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,o,c,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.props.duration.duration,a=1e3*n/2,o=new Date(t).getTime(),c=o-a,l=o+a,e.next=7,i.promisedSetState({history:{start:c,end:l,format:"json"},modal:(0,s.Z)((0,s.Z)({},i.state.modal),{},{open:!1})});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.handleSelect=(0,Ne.Z)(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n){var a,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=i.props.t,o={from:"history",dialog:(0,s.Z)((0,s.Z)({},i.state.select.dialog),{},{open:!1})},e.t0=t,e.next="history"===e.t0?5:"trace"===e.t0?10:15;break;case 5:return e.next=7,i.promisedSetState({select:o,history:(0,s.Z)((0,s.Z)({},i.state.history),{},{channel:n,format:"sac"})});case 7:return e.next=9,V.ZP.promise(i.handleQueryHistory(),{loading:a("views.history.toasts.is_exporting_sac"),success:a("views.history.toasts.export_sac_success"),error:a("views.history.toasts.export_sac_error")});case 9:case 14:return e.abrupt("break",15);case 10:return e.next=12,i.promisedSetState({select:o,trace:(0,s.Z)((0,s.Z)({},i.state.trace),{},{source:n})});case 12:return e.next=14,V.ZP.promise(i.handleQueryEvents(),{loading:a("views.history.toasts.is_fetching_events"),success:a("views.history.toasts.fetch_events_success"),error:a("views.history.toasts.fetch_events_error")});case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),200),i.handleQueryWaveform=(0,Ne.Z)((0,a.Z)((0,r.Z)().mark((function e(){var t,n,a,o,c,l,u,h;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.promisedSetState({history:(0,s.Z)((0,s.Z)({},i.state.history),{},{format:"json"})});case 2:return t=i.props.t,e.next=5,V.ZP.promise(i.handleQueryHistory(),{loading:t("views.history.toasts.is_fetching_waveform"),success:t("views.history.toasts.fetch_waveform_success"),error:t("views.history.toasts.fetch_waveform_error")});case 5:(n=e.sent)&&(a=i.state,o=a.adc,c=a.geophone,l=a.scale,u=Ze(i.state.labels,n,o,c,l),h=ke(i.state.areas,n),i.setState({areas:h,labels:u}));case 7:case"end":return e.stop()}}),e)})))),i.handleQuerySACFile=(0,a.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.setState((function(e){return{select:(0,s.Z)((0,s.Z)({},e.select),{},{from:"history",dialog:{open:!0,values:[["Vertical","EHZ"],["East-West","EHE"],["North-South","EHN"]],title:{id:"views.history.selects.choose_channel.title"}}})}}));case 1:case"end":return e.stop()}}),e)}))),i.handleQuerySource=(0,Ne.Z)((0,a.Z)((0,r.Z)().mark((function e(){var t,n,a,o,c,l,u,h,d,p;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.props.t,n={source:"show"},a=i.state.tokens,o=Se.Z.CancelToken.source,c=o(),a.push(c),l=V.ZP.loading(t("views.history.toasts.is_fetching_source")),e.next=9,(0,O.Z)({cancelToken:c,body:n,tag:"trace"});case 9:if(u=e.sent,h=u.data,d=u.error,V.ZP.remove(l),!d&&h){e.next=19;break}return p=t("views.history.toasts.fetch_source_error"),V.ZP.error(p),e.abrupt("return",Promise.reject(p));case 19:V.ZP.success(t("views.history.toasts.fetch_source_success"));case 20:i.setState((function(e){return{select:{from:"trace",dialog:(0,s.Z)((0,s.Z)({},e.select.dialog),{},{open:!0,values:h.map((function(e){return[e.name,e.value]})),title:{id:"views.history.selects.choose_source.title"}})}}}));case 21:case"end":return e.stop()}}),e)})))),i.handleGetShareLink=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,a,s,o,c,l,u,h,d,p;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(0,Ce.Z)(),n=i.props.t,a=window.location,s=a.hash,o=a.origin,c=i.state.history,l=c.start,u=c.end,h="".concat(o).concat(s.length&&"/#").concat(t),d="".concat(h,"?start=").concat(l,"&end=").concat(u),!(p=navigator.clipboard||{writeText:function(e){var t=document.createElement("input");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}})){e.next=13;break}return e.next=10,p.writeText(d);case 10:V.ZP.success(n("views.history.toasts.copy_link_success")),e.next=14;break;case 13:V.ZP.error(n("views.history.toasts.copy_link_error"));case 14:case"end":return e.stop()}}),e)}))),i.state={tokens:[],trace:{source:"show"},history:{start:0,end:0,format:"json",channel:"EHZ"},areas:[{tag:"ehz",area:{label:{id:"views.history.areas.ehz.label"}},chart:{backgroundColor:"#d97706",lineWidth:1,height:300,series:{name:"EHZ",type:"line",color:"#f1f5f9",data:[]}}},{tag:"ehe",area:{label:{id:"views.history.areas.ehe.label"}},chart:{backgroundColor:"#10b981",lineWidth:1,height:300,series:{name:"EHE",type:"line",color:"#f1f5f9",data:[]}}},{tag:"ehn",area:{label:{id:"views.history.areas.ehn.label"}},chart:{backgroundColor:"#0ea5e9",lineWidth:1,height:300,series:{name:"EHN",type:"line",color:"#f1f5f9",data:[]}}}],select:{from:"history",dialog:{open:!1,title:{id:"views.history.selects.choose_channel.title"},values:[["Vertical","EHZ"],["East-West","EHE"],["North-South","EHN"]]}},modal:{open:!1,values:[],title:{id:"views.history.modals.choose_event.title"}},geophone:{ehz:1,ehe:1,ehn:1},adc:{fullscale:1,resolution:1},labels:[{tag:"ehz-pga",label:{id:"views.history.labels.ehz_pga.label"},unit:{id:"views.history.labels.ehz_pga.unit"},value:"0"},{tag:"ehz-intensity",label:{id:"views.history.labels.ehz_intensity.label"},unit:{id:"views.history.labels.ehz_intensity.unit"},value:"Unknown"},{tag:"ehe-pga",label:{id:"views.history.labels.ehe_pga.label"},unit:{id:"views.history.labels.ehe_pga.unit"},value:"0"},{tag:"ehe-intensity",label:{id:"views.history.labels.ehe_intensity.label"},unit:{id:"views.history.labels.ehe_intensity.unit"},value:"Unknown"},{tag:"ehn-pga",label:{id:"views.history.labels.ehn_pga.label"},unit:{id:"views.history.labels.ehn_pga.unit"},value:"0"},{tag:"ehn-intensity",label:{id:"views.history.labels.ehn_intensity.label"},unit:{id:"views.history.labels.ehn_intensity.unit"},value:"Unknown"}],scale:me.m.property()},i}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,a,o,i,c,l,u,h,d,p,f,v,m,Z,y,g;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.adc.adc,n=this.props.scale.scale,a=this.props.geophone.geophone,i=(o=a).ehz,c=o.ehe,l=o.ehn,-1!==t.resolution&&i*c*l!==0){e.next=20;break}return e.next=8,(0,O.Z)({tag:"station"});case 8:if(!(u=e.sent).data){e.next=17;break}a=R(u),t=Y(u),h=this.props,d=h.updateADC,(p=h.updateGeophone)&&p(a),d&&d(t),e.next=20;break;case 17:return f=this.props.t,V.ZP.error(f("views.history.toasts.metadata_error")),e.abrupt("return");case 20:v=this.props.duration.duration,m=_e(),Z=m.start,y=m.end,g=(0,s.Z)((0,s.Z)({},this.state.history),{},{start:Z?Number(Z):Date.now()-1e3*v,end:y?Number(y):Date.now()}),this.setState({history:g,adc:t,geophone:a,scale:n});case 24:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.state.tokens.forEach((function(e){return e.cancel()}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.areas,r=t.select,a=t.modal,o=t.history,i=t.labels,c=r.from,l=r.dialog,u=o.start,y=o.end;return(0,F.jsxs)(v.Z,{children:[(0,F.jsx)(h.Z,{}),(0,F.jsx)(d.Z,{}),(0,F.jsxs)(f.Z,{children:[(0,F.jsx)(p.Z,{}),(0,F.jsxs)(q.Z,{className:"mb-6",layout:"grid",children:[(0,F.jsxs)(U.Z,{className:"h-[360px]",label:{id:"views.history.cards.query_history"},children:[(0,F.jsx)(Q,{value:u,label:{id:"views.history.time_pickers.start_time"},onChange:function(t){return e.handleTimeChange("start",t)}}),(0,F.jsx)(Q,{value:y,label:{id:"views.history.time_pickers.end_time"},onChange:function(t){return e.handleTimeChange("end",t)}}),(0,F.jsx)(L.Z,{className:"bg-indigo-700 hover:bg-indigo-800",onClick:this.handleQueryWaveform,label:{id:"views.history.buttons.query_waveform"}}),(0,F.jsx)(L.Z,{className:"bg-green-700 hover:bg-green-800",onClick:this.handleQuerySACFile,label:{id:"views.history.buttons.query_sac_file"}}),(0,F.jsx)(L.Z,{className:"bg-yellow-700 hover:bg-yellow-800",onClick:this.handleQuerySource,label:{id:"views.history.buttons.query_source"}}),(0,F.jsx)(L.Z,{className:"bg-cyan-700 hover:bg-cyan-800",onClick:this.handleGetShareLink,label:{id:"views.history.buttons.get_share_link"}})]}),(0,F.jsx)(U.Z,{label:{id:"views.history.cards.analyse_history"},children:(0,F.jsx)(q.Z,{layout:"grid",children:i.map((function(e,t){return(0,F.jsx)(ce.Z,(0,s.Z)({},e),t)}))})})]}),n.map((function(e,t){var n=e.area,r=e.chart;return(0,F.jsx)(we.Z,(0,s.Z)((0,s.Z)({},n),{},{children:(0,F.jsx)(I.Z,(0,s.Z)((0,s.Z)({},r),{},{tooltip:!0,zooming:!0,animation:!1,tickPrecision:1,tickInterval:10}))}),t)}))]}),(0,F.jsx)(m.Z,{}),(0,F.jsx)(Z.Z,{}),(0,F.jsx)(G.Z,(0,s.Z)((0,s.Z)({},l),{},{onSelect:function(t){return e.handleSelect(c,t)}})),(0,F.jsx)(oe,(0,s.Z)((0,s.Z)({},a),{},{onSelect:this.handleChooseEvent,onClose:function(){return e.setState({modal:(0,s.Z)((0,s.Z)({},a),{},{open:!1})})}})),(0,F.jsx)(V.x7,{position:"top-center"})]})}}]),n}(u.Component),Te=(0,xe.$j)(be.Z,{updateGeophone:ge.V,updateADC:ye.V})((0,D.Zh)()(Me))}}]);