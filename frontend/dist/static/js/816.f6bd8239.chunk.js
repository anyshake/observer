"use strict";(self.webpackChunkobserver=self.webpackChunkobserver||[]).push([[816],{8864:function(e,t){t.Z=function(e,t){for(var n=[],a=0;a<e.length;a++)a?n.push((e[a]-e[a-1])/t):n.push(0);return n}},6466:function(e,t,n){var a=n(7762);t.Z=function(e,t){var n,r=[],o=(0,a.Z)(e);try{for(o.s();!(n=o.n()).done;){var s=n.value;r.push(s/t)}}catch(i){o.e(i)}finally{o.f()}return r}},5973:function(e,t,n){var a=n(7762);t.Z=function(e,t,n){var r,o=Math.pow(2,t-1),s=[],i=(0,a.Z)(e);try{for(i.s();!(r=i.n()).done;){var c=r.value;s.push(n/o*c)}}catch(l){i.e(l)}finally{i.f()}return s}},5653:function(e,t){t.Z=function(e){var t=new Date(e),n=t.getFullYear(),a=(t.getMonth()+1).toString().padStart(2,"0"),r=t.getDate().toString().padStart(2,"0"),o=t.getHours().toString().padStart(2,"0"),s=t.getMinutes().toString().padStart(2,"0"),i=t.getSeconds().toString().padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(r," ").concat(o,":").concat(s,":").concat(i)}},3816:function(e,t,n){n.r(t),n.d(t,{default:function(){return q}});var a=n(4165),r=n(5861),o=n(1413),s=n(5671),i=n(3144),c=n(136),l=n(9388),u=n(2791),h=n(8906),p=n(3893),d=n(7295),v=n(8491),f=n(7324),g=n(5577),b=n(1620),w=n(7121),Z=n(5474),k=n(7528),m=n(3605),x=n(7995),y=function(e){var t=e.data.adc;return{resolution:t.resolution,fullscale:t.fullscale}},S=function(e){var t=e.data.geophone;return{ehz:t.ehz,ehe:t.ehe,ehn:t.ehn}},C=n(3876),j=n(6929),W=n(4127),E=function(e){var t=e.tag,n=e.onOpen,a=e.onData,r=e.onClose,o=e.onError;try{var s;if("ws"!==(null===(s=C.Z.find((function(e){return e.tag===t})))||void 0===s?void 0:s.type))throw new Error("non-websocket protocol is not supported");var i=(0,j.Z)(t),c="https:"===window.location.protocol?"wss:":"ws:",l=new WebSocket("".concat(c).concat((0,W.Z)()).concat(i));return l.onmessage=a,l.onopen=n||function(){},l.onclose=r||function(){},l.onerror=o||function(){},l}catch(u){return void(o&&o(new Event("error occurred")))}},D=n(5218),z=n(5653),H=function(e,t,n){var a=e||{ts:-1,ehz:0,ehe:0,ehn:0},r=a.ts,o=a.ehz,s=a.ehe,i=a.ehn,c=(1e3*((o.length+s.length+i.length)/3)/(r-(t||0))).toFixed(2);return-1===r&&o*i*s===0?{type:"error",label:{id:"views.realtime.banner.error.label"},text:{id:"views.realtime.banner.error.text"}}:{type:"success",label:{id:"views.realtime.banner.success.label",format:{sampleRate:c}},text:{id:"views.realtime.banner.success.text",format:{time:(0,z.Z)(r),scale:"".concat(null===n||void 0===n?void 0:n.value," - ").concat(null===n||void 0===n?void 0:n.name)||"Unknown"}}}},M=n(7762),O=n(6466),L=n(9757),_=n(5973),P=n(1943),T=n(8864),A=n(3671),F=function(e,t,n,a,r,o,s){var i,c=t.ts,l=(0,M.Z)(e);try{var u=function(){for(var l,u,h=i.value,p=t.ehz,d=t.ehe,v=t.ehn,f=(p.length+d.length+v.length)/3,g=0!==n?c-n:1e3,b=g/f,w=t[h.tag],Z=(0,_.Z)(w,r.resolution,r.fullscale),k=(0,O.Z)(Z,o[h.tag]),m=(0,T.Z)(k,b/g),x=null===(l=e.find((function(e){return e.tag===h.tag})))||void 0===l||null===(u=l.chart.series)||void 0===u?void 0:u.data,y=[],S=0;S<w.length;S++)y.push([c-(f-S)*b,w[S]]);var C=(0,L.Z)(x,y,a*f);(0,P.Z)(e,"[tag:".concat(h.tag,"]>chart>series>data"),C);var j=k.reduce((function(e,t){var n=Math.abs(e),a=Math.abs(t);return Math.max(n,a)}),0),W=m.reduce((function(e,t){var n=Math.abs(e),a=Math.abs(t);return Math.max(n,a)}),0),E=A.Z.app_settings.scales.find((function(e){return e.property().value===s.value})),D=null===E||void 0===E?void 0:E.intensity(j,W);(0,P.Z)(e,"[tag:".concat(h.tag,"]>area>text"),{id:"views.realtime.areas.".concat(h.tag,".text"),format:{pga:W.toFixed(5),pgv:j.toFixed(5),intensity:"".concat(s.value," ").concat(D)}})};for(l.s();!(i=l.n()).done;)u()}catch(h){l.e(h)}finally{l.f()}return e},I=n(8687),V=n(4964),G=n(2129),N=n(3586),U=n(86),J=n(9230),R=function(e){var t,n=(null===(t=e.data)||void 0===t?void 0:t.station)||{};return{station:n.station,network:n.network,location:n.location}},Y=n(3329),$=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(e){var a;return(0,s.Z)(this,n),(a=t.call(this,e)).prevTs=void 0,a.websocket=void 0,a.handleWebsocketOpen=function(){setTimeout((function(){var e=a.props.t;D.ZP.success(e("views.realtime.toasts.websocket_connected"))}),500)},a.handleWebsocketClose=function(){if(a.websocket&&a.websocket instanceof WebSocket){var e=H();a.setState({banner:e}),a.websocket=E({tag:"socket",onData:a.handleWebsocketData,onOpen:a.handleWebsocketOpen,onClose:a.handleWebsocketClose})}},a.handleWebsocketData=function(e){var t=JSON.parse(e.data),n=a.state,r=n.adc,o=n.geophone,s=n.scale,i=H(t,a.prevTs,s),c=a.props.retention.retention,l=F(a.state.areas,t,a.prevTs,c,r,o,s);a.prevTs=t.ts,a.setState({banner:i,areas:l})},a.setChartHeight=function(){var e=a.state.areas,t=window.innerHeight,n=Math.round(.6*t/e.length);n<150&&(n=150),a.setState({areas:e.map((function(e){return(0,o.Z)((0,o.Z)({},e),{},{chart:(0,o.Z)((0,o.Z)({},e.chart),{},{height:n})})}))})},a.state={banner:{type:"warning",label:{id:"views.realtime.banner.warning.label"},text:{id:"views.realtime.banner.warning.text"}},areas:[{tag:"ehz",area:{collapse:Z.j.COLLAPSE_HIDE,label:{id:"views.realtime.areas.ehz.label"},text:{id:"views.realtime.areas.ehz.text",format:{pga:"0.00000",pgv:"0.00000",intensity:"-"}}},chart:{backgroundColor:"#d97706",lineWidth:1,series:{name:"EHZ",type:"line",color:"#f1f5f9",data:[]}}},{tag:"ehe",area:{collapse:Z.j.COLLAPSE_HIDE,label:{id:"views.realtime.areas.ehe.label"},text:{id:"views.realtime.areas.ehe.text",format:{pga:"0.00000",pgv:"0.00000",intensity:"-"}}},chart:{backgroundColor:"#10b981",lineWidth:1,series:{name:"EHE",type:"line",color:"#f1f5f9",data:[]}}},{tag:"ehn",area:{collapse:Z.j.COLLAPSE_HIDE,label:{id:"views.realtime.areas.ehn.label"},text:{id:"views.realtime.areas.ehn.text",format:{pga:"0.00000",pgv:"0.00000",intensity:"-"}}},chart:{backgroundColor:"#0ea5e9",lineWidth:1,series:{name:"EHN",type:"line",color:"#f1f5f9",data:[]}}}],adc:{fullscale:1,resolution:1},geophone:{ehz:1,ehe:1,ehn:1},scale:A.m.property()},a.websocket=null,a.prevTs=0,a}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){var e=(0,r.Z)((0,a.Z)().mark((function e(){var t,n,r,o,s,i,c,l,u,h,p,d,v,f,g,b,w,Z;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.addEventListener("resize",this.setChartHeight),this.setChartHeight(),n=this.props.adc.adc,r=n.resolution,o=this.props.geophone.geophone,i=(s=o).ehz,c=s.ehe,l=s.ehn,u=this.props.scale.scale,h=this.props.station.station,-1!==r&&i*c*l!==0){e.next=25;break}return e.next=11,(0,x.Z)({tag:"station"});case 11:if(!(p=e.sent).data){e.next=22;break}o=S(p),h=R(p),n=y(p),d=this.props,v=d.updateADC,f=d.updateGeophone,g=d.updateStation,f&&f(o),g&&g(h),v&&v(n),e.next=25;break;case 22:return b=this.props.t,D.ZP.error(b("views.realtime.toasts.fetch_metadata_error")),e.abrupt("return");case 25:w=A.Z.app_settings.scales,Z=(null===(t=w.find((function(e){return e.property().value===u})))||void 0===t?void 0:t.property())||A.m.property(),this.setState({adc:n,geophone:o,scale:Z}),this.websocket=E({tag:"socket",onData:this.handleWebsocketData,onOpen:this.handleWebsocketOpen,onClose:this.handleWebsocketClose});case 29:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){var e;(window.removeEventListener("resize",this.setChartHeight),this.websocket instanceof WebSocket)&&(null===(e=this.websocket)||void 0===e||e.close(),this.websocket={})}},{key:"render",value:function(){var e=this.state,t=e.areas,n=e.banner;return(0,Y.jsxs)(f.Z,{children:[(0,Y.jsx)(h.Z,{}),(0,Y.jsx)(p.Z,{}),(0,Y.jsxs)(d.Z,{children:[(0,Y.jsx)(v.Z,{}),(0,Y.jsx)(b.Z,(0,o.Z)({},n)),(0,Y.jsx)(k.Z,{layout:"none",children:t.map((function(e,t){var n=e.area,a=e.chart;return(0,Y.jsx)(Z.Z,(0,o.Z)((0,o.Z)({},n),{},{children:(0,Y.jsx)(m.Z,(0,o.Z)((0,o.Z)({},a),{},{tooltip:!0,zooming:!0,animation:!1,tickPrecision:1,tickInterval:1e3}))}),t)}))})]}),(0,Y.jsx)(g.Z,{}),(0,Y.jsx)(w.Z,{}),(0,Y.jsx)(D.x7,{position:"top-center"})]})}}]),n}(u.Component),q=(0,I.$j)(U.Z,{updateGeophone:G.V,updateADC:V.V,updateStation:N.V})((0,J.Zh)()($))}}]);
//# sourceMappingURL=816.f6bd8239.chunk.js.map