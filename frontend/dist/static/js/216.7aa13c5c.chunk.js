"use strict";(self.webpackChunkg_observer=self.webpackChunkg_observer||[]).push([[216],{426:function(e,t){t.Z=function(e,t){for(var n=[],r=0;r<e.length;r++)r?n.push((e[r]-e[r-1])/t):n.push(0);return n}},2442:function(e,t,n){t.ZP=function(e,t,n){switch(n){case"MMI":return function(e,t){switch(!0){case t<1:return"1 \u5ea6";case t<2.1:return"2 \u5ea6";case t<5:return"3 \u5ea6";case t<10:return"4 \u5ea6";case t<21:return"5 \u5ea6";case t<44:return"6 \u5ea6";case t<94:return"7 \u5ea6";case t<202:return"8 \u5ea6";case t<432:return"9 \u5ea6"}return t>=432&&e>116?"10 \u5ea6":t>=432?"11 \u5ea6":"12 \u5ea6"}(e,t);case"CSIS":return function(e,t){var n=3.17*Math.log10(t)+6.59,r=3*Math.log10(e)+9.77,a=1;return(a=n>=6&&r>=6?r:(n+r)/2)<1?a=1:a>12&&(a=12),"".concat(a.toFixed(1)," \u7ea7")}(e,t);case"CWB":return function(e,t){if(t<80)switch(!0){case t<.8:return"0 \u7d1a";case t<2.5:return"1 \u7d1a";case t<8:return"2 \u7d1a";case t<25:return"3 \u7d1a";case t<80:return"4 \u7d1a"}else switch(!0){case e<15:return"4 \u7d1a";case e<30:return"5 \u5f31";case e<50:return"5 \u5f37";case e<80:return"6 \u5f31";case e<140:return"6 \u5f37"}return"7 \u7d1a"}(e,t);case"JMA":return function(e){var t=parseFloat((2*Math.log10(e)+.94).toFixed(3));switch(t=parseFloat(t.toFixed(2)),!0){case t<.5:return"0";case t<1.5:return"1";case t<2.5:return"2";case t<3.5:return"3";case t<4.5:return"4";case t<5:return"5 \u5f31";case t<5.5:return"5 \u5f37";case t<6:return"6 \u5f31";case t<6.5:return"6 \u5f37";default:return"7"}}(t);default:return"\u672a\u77e5"}}},4949:function(e,t){t.Z=function(e,t){return localStorage.getItem(e)?localStorage.getItem(e):(localStorage.setItem(e,t),t)}},6586:function(e,t){t.Z=function(e){var t=new Date(e),n=t.getFullYear(),r=(t.getMonth()+1).toString().padStart(2,"0"),a=t.getDate().toString().padStart(2,"0"),o=t.getHours().toString().padStart(2,"0"),c=t.getMinutes().toString().padStart(2,"0"),s=t.getSeconds().toString().padStart(2,"0");return"".concat(n,"-").concat(r,"-").concat(a," ").concat(o,":").concat(c,":").concat(s)}},9603:function(e,t,n){var r=n(7762);t.Z=function(e,t){var n,a=[],o=(0,r.Z)(e);try{for(o.s();!(n=o.n()).done;){var c=n.value;a.push(c/t)}}catch(s){o.e(s)}finally{o.f()}return a}},5693:function(e,t,n){var r=n(7762);t.Z=function(e,t,n){var a,o=Math.pow(2,t-1),c=[],s=(0,r.Z)(e);try{for(s.s();!(a=s.n()).done;){var u=a.value;c.push(n/o*u)}}catch(i){s.e(i)}finally{s.f()}return c}},1216:function(e,t,n){n.r(t),n.d(t,{default:function(){return _}});var r=n(1413),a=n(4165),o=n(5861),c=n(5671),s=n(3144),u=n(136),i=n(7277),l=n(7313),h=n(4791),f=n(3534),d=n(501),p=n(5097),g=n(4656),v=n(284),Z=n(318),b=n(771),x=n(5608),k=n(1109),w=n(3676),S=n(7596),m=function(e){var t=e.data.adc;return{resolution:t.resolution,fullscale:t.fullscale}},y=function(e){var t=e.data.geophone;return{ehz:t.ehz,ehe:t.ehe,ehn:t.ehn}},M=n(1677),P=n(8687),j=n(1647),E=function(e){var t=e.tag,n=e.onOpen,r=e.onData,a=e.onClose,o=e.onError;try{var c;if("ws"!==(null===(c=M.Z.find((function(e){return e.tag===t})))||void 0===c?void 0:c.type))throw new Error("non-websocket protocol is not supported");var s=(0,P.Z)(t),u="https:"===window.location.protocol?"wss:":"ws:",i=new WebSocket("".concat(u).concat((0,j.Z)()).concat(s));return i.onmessage=r,i.onopen=n||function(){},i.onclose=a||function(){},i.onerror=o||function(){},i}catch(l){return void(o&&o(new Event("error occurred")))}},W=n(6059),C=n(6586),F=function(e,t,n){var r=e.ts,a=e.ehz,o=e.ehe,c=e.ehn,s=(a.length+o.length+c.length)/3;return{type:"success",label:"\u8fde\u63a5\u6210\u529f\uff1a\u5b9e\u9645\u91c7\u6837\u7387 ".concat((1e3*s/(r-t)).toFixed(2)," Sps"),text:"\u5f53\u524d\u9707\u5ea6\u6807\u51c6\u4e3a ".concat(n,"\n\u6570\u636e\u6700\u540e\u66f4\u65b0\u4e8e ").concat((0,C.Z)(r))}},z=n(9603),G=n(6694),D=n(5693),H=n(1880),I=n(426),T=n(2442),A=function(e,t,n,r,a,o,c){for(var s=t.ts,u=function(){for(var u,h,f=l[i],d=t.ehz,p=t.ehe,g=t.ehn,v=(d.length+p.length+g.length)/3,Z=0!==n?s-n:1e3,b=Z/v,x=(0,D.Z)(t[f],a.resolution,a.fullscale),k=(0,z.Z)(x,o[f]),w=(0,I.Z)(k,b/Z),S=null===(u=e.find((function(e){return e.tag===f})))||void 0===u||null===(h=u.chart.series)||void 0===h?void 0:h.data,m=[],y=0;y<w.length;y++)m.push([s-(v-y)*b,w[y]]);var M=(0,G.Z)(S,m,r*v);(0,H.Z)(e,"[tag:".concat(f,"]>chart>series>data"),M);var P=k.reduce((function(e,t){var n=Math.abs(e),r=Math.abs(t);return Math.max(n,r)}),0),j=w.reduce((function(e,t){var n=Math.abs(e),r=Math.abs(t);return Math.max(n,r)}),0),E=(0,T.ZP)(P,j,c);(0,H.Z)(e,"[tag:".concat(f,"]>area>text"),"PGA\uff1a".concat(j.toFixed(5)," gal\n\n            PGV\uff1a").concat(P.toFixed(5)," cm/s\n\n            \u9707\u5ea6\uff1a").concat(c," \u9707\u5ea6 ").concat(E))},i=0,l=["ehz","ehe","ehn"];i<l.length;i++)u();return e},O=n(4949),V=n(8191),N=n(6417),_=function(e){(0,u.Z)(n,e);var t=(0,i.Z)(n);function n(e){var r;return(0,c.Z)(this,n),(r=t.call(this,e)).prevTs=void 0,r.websocket=void 0,r.handleWebsocketOpen=function(){setTimeout((function(){W.ZP.success("Websocket \u8fde\u7ebf\u5df2\u7ecf\u5efa\u7acb")}),500)},r.handleWebsocketData=function(e){var t=r.state,n=t.adc,a=t.geophone,o=t.scale,c=JSON.parse(e.data),s=F(c,r.prevTs,o),u=A(r.state.areas,c,r.prevTs,180,n,a,o);r.prevTs=c.ts,r.setState({banner:s,areas:u})},r.state={scale:"",banner:{type:"warning",label:"\u6b63\u5728\u8fde\u63a5\u670d\u52a1\u5668",text:"\u8bf7\u7a0d\u7b49..."},areas:[{tag:"ehz",area:{label:"EHZ \u901a\u9053\u52a0\u901f\u5ea6",text:"PGA\uff1a\u6b63\u5728\u83b7\u53d6\u4e2d\nPGV\uff1a\u6b63\u5728\u83b7\u53d6\u4e2d\n\u9707\u5ea6\uff1a\u6b63\u5728\u83b7\u53d6\u4e2d"},chart:{backgroundColor:"#d97706",lineWidth:1,height:300,series:{name:"EHZ",type:"line",color:"#fff",data:[]}}},{tag:"ehe",area:{label:"EHE \u901a\u9053\u52a0\u901f\u5ea6",text:"PGA\uff1a\u6b63\u5728\u83b7\u53d6\u4e2d\nPGV\uff1a\u6b63\u5728\u83b7\u53d6\u4e2d\n\u9707\u5ea6\uff1a\u6b63\u5728\u83b7\u53d6\u4e2d"},chart:{backgroundColor:"#10b981",lineWidth:1,height:300,series:{name:"EHE",type:"line",color:"#fff",data:[]}}},{tag:"ehn",area:{label:"EHN \u901a\u9053\u52a0\u901f\u5ea6",text:"PGA\uff1a\u6b63\u5728\u83b7\u53d6\u4e2d\nPGV\uff1a\u6b63\u5728\u83b7\u53d6\u4e2d\n\u9707\u5ea6\uff1a\u6b63\u5728\u83b7\u53d6\u4e2d"},chart:{backgroundColor:"#0ea5e9",lineWidth:1,height:300,series:{name:"EHN",type:"line",color:"#fff",data:[]}}}],geophone:{ehz:.288,ehe:.288,ehn:.288},adc:{fullscale:5,resolution:24}},r.prevTs=0,r.websocket=null,r}return(0,s.Z)(n,[{key:"componentDidMount",value:function(){var e=(0,o.Z)((0,a.Z)().mark((function e(){var t,n,r,o,c,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,S.Z)({tag:"station"});case 2:if(!(t=e.sent).data){e.next=11;break}n=V.Z.app_settings.scale,r=m(t),o=y(t),c=(0,O.Z)("scale",n),this.setState({adc:r,geophone:o,scale:c}),e.next=14;break;case 11:return s="\u53d6\u5f97\u6d4b\u7ad9\u8d44\u8baf\u65f6\u53d1\u751f\u9519\u8bef\uff0c\u529f\u80fd\u65e0\u6cd5\u4f7f\u7528",W.ZP.error(s),e.abrupt("return",Promise.reject(s));case 14:this.websocket=E({tag:"socket",onData:this.handleWebsocketData,onOpen:this.handleWebsocketOpen});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.websocket&&(this.websocket.close(),this.websocket=null)}},{key:"render",value:function(){var e=this.state,t=e.areas,n=e.banner;return(0,N.jsxs)(g.Z,{children:[(0,N.jsx)(h.Z,{}),(0,N.jsx)(f.Z,{}),(0,N.jsxs)(d.Z,{children:[(0,N.jsx)(p.Z,{}),(0,N.jsx)(Z.Z,(0,r.Z)({},n)),(0,N.jsx)(k.Z,{layout:"none",children:t.map((function(e,t){var n=e.area,a=e.chart;return(0,N.jsx)(x.Z,(0,r.Z)((0,r.Z)({},n),{},{children:(0,N.jsx)(w.Z,(0,r.Z)((0,r.Z)({},a),{},{tooltip:!0,zooming:!0,animation:!1,tickPrecision:.4,tickInterval:1e-4}))}),t)}))})]}),(0,N.jsx)(v.Z,{}),(0,N.jsx)(b.Z,{}),(0,N.jsx)(W.x7,{position:"top-center"})]})}}]),n}(l.Component)}}]);