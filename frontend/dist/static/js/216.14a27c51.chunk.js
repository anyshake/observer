"use strict";(self.webpackChunkg_observer=self.webpackChunkg_observer||[]).push([[216],{5608:function(e,t,n){n.d(t,{Z:function(){return l}});var a=n(5671),r=n(3144),o=n(136),s=n(7277),c=n(7313),i=n(6417),l=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.children,n=e.label,a=e.text;return(0,i.jsxs)("div",{className:"mb-4 bg-white flex flex-col rounded-xl text-gray-700 shadow-lg",children:[(0,i.jsx)("div",{className:"mx-4 rounded-lg overflow-hidden shadow-lg",children:t}),(0,i.jsxs)("div",{className:"p-4",children:[(0,i.jsx)("h6",{className:"text-md font-bold text-gray-800",children:n}),(0,i.jsx)("span",{className:"text-md",children:a.split("\n").map((function(e,t){return(0,i.jsx)("p",{children:e},t)}))})]})]})}}]),n}(c.Component)},318:function(e,t,n){n.d(t,{Z:function(){return d}});var a=n(5671),r=n(3144),o=n(136),s=n(7277),c=n(7313);var i=n.p+"static/media/rss-solid.167813b1d681372ed1d98e45b6b6c0f7.svg";var l=n.p+"static/media/link-solid.49819f951200a220d9839699fbccd8de.svg";var u=n.p+"static/media/link-slash-solid.7893b9a51ad07ceedeb88c9649c58439.svg",h=n(6417),d=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(){return(0,a.Z)(this,n),t.apply(this,arguments)}return(0,r.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.type,n=e.label,a=e.text,r=u,o="";switch(t){case"success":r=i,o="from-green-400 to-blue-500";break;case"warning":r=l,o="from-orange-400 to-orange-600";break;case"error":r=u,o="from-red-400 to-red-600"}return(0,h.jsx)("div",{className:"my-2 shadow-xl p-6 text-sm text-white rounded-lg bg-gradient-to-r ".concat(o),children:(0,h.jsxs)("div",{className:"flex flex-col gap-y-2",children:[(0,h.jsxs)("div",{className:"flex gap-2 font-bold text-lg",children:[(0,h.jsx)("img",{className:"w-6 h-6",src:r,alt:""}),(0,h.jsx)("span",{children:n})]}),(0,h.jsx)("span",{className:"pl-3 text-md font-medium",children:a.split("\n").map((function(e,t){return(0,h.jsx)("p",{children:e},t)}))})]})})}}]),n}(c.Component)},426:function(e,t){t.Z=function(e,t){for(var n=[],a=0;a<e.length;a++)a?n.push((e[a]-e[a-1])/t):n.push(0);return n}},6694:function(e,t,n){var a=n(3433);t.Z=function(e,t,n){if(t.some((function(e){return e instanceof Array})))for(var r=0;r<t.length;r++)e.push(t[r]);else e.push(t);return e.length>n&&e.splice(0,e.length-n),(0,a.Z)(e)}},6586:function(e,t){t.Z=function(e){var t=new Date(e),n=t.getFullYear(),a=(t.getMonth()+1).toString().padStart(2,"0"),r=t.getDate().toString().padStart(2,"0"),o=t.getHours().toString().padStart(2,"0"),s=t.getMinutes().toString().padStart(2,"0"),c=t.getSeconds().toString().padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(r," ").concat(o,":").concat(s,":").concat(c)}},9603:function(e,t,n){var a=n(7762);t.Z=function(e,t){var n,r=[],o=(0,a.Z)(e);try{for(o.s();!(n=o.n()).done;){var s=n.value;r.push(s/t)}}catch(c){o.e(c)}finally{o.f()}return r}},5693:function(e,t,n){var a=n(7762);t.Z=function(e,t,n){var r,o=Math.pow(2,t-1),s=[],c=(0,a.Z)(e);try{for(c.s();!(r=c.n()).done;){var i=r.value;s.push(n/o*i)}}catch(l){c.e(l)}finally{c.f()}return s}},1216:function(e,t,n){n.r(t),n.d(t,{default:function(){return H}});var a=n(1413),r=n(4165),o=n(5861),s=n(5671),c=n(3144),i=n(136),l=n(7277),u=n(7313),h=n(4791),d=n(4066),f=n(501),p=n(5097),v=n(4656),g=n(284),x=n(318),Z=n(771),b=n(5608),m=n(1109),k=n(3676),w=n(7596),y=function(e){var t=e.data.adc;return{resolution:t.resolution,fullscale:t.fullscale}},j=function(e){var t=e.data.geophone;return{ehz:t.ehz,ehe:t.ehe,ehn:t.ehn}},S=n(1677),N=n(8687),M=n(1647),P=function(e){var t=e.tag,n=e.onOpen,a=e.onData,r=e.onClose,o=e.onError;try{var s;if("ws"!==(null===(s=S.Z.find((function(e){return e.tag===t})))||void 0===s?void 0:s.type))throw new Error("non-websocket protocol is not supported");var c=(0,N.Z)(t),i="https:"===window.location.protocol?"wss:":"ws:",l=new WebSocket("".concat(i).concat((0,M.Z)()).concat(c));return l.onmessage=a,l.onopen=n||function(){},l.onclose=r||function(){},l.onerror=o||function(){},l}catch(u){return void(o&&o(new Event("error occurred")))}},W=n(6059),C=n(6586),z=function(e,t){var n=e.ts,a=e.ehz,r=e.ehe,o=e.ehn,s=(a.length+r.length+o.length)/3;return{type:"success",label:"\u8fde\u63a5\u6210\u529f\uff1a\u91c7\u6837\u7387 ".concat((1e3*s/(n-t)).toFixed(2)," Sps"),text:"\u6570\u636e\u6700\u540e\u66f4\u65b0\u4e8e ".concat((0,C.Z)(n))}},G=n(9603),D=n(6694),E=n(5693),T=n(1880),A=n(426),O=function(e,t,n,a,r,o){for(var s=t.ts,c=function(){for(var c,u,h=l[i],d=t.ehz,f=t.ehe,p=t.ehn,v=(d.length+f.length+p.length)/3,g=0,x=0!==n?s-n:1e3,Z=x/(g=0!==n?1e3*v/(s-n):v),b=(0,E.Z)(t[h],r.resolution,r.fullscale),m=(0,G.Z)(b,o[h]),k=(0,A.Z)(m,Z/x),w=null===(c=e.find((function(e){return e.tag===h})))||void 0===c||null===(u=c.chart.series)||void 0===u?void 0:u.data,y=[],j=0;j<k.length;j++)y.push([s-(g-j)*Z,k[j]]);var S=(0,D.Z)(w,y,a*g);(0,T.Z)(e,"[tag:".concat(h,"]>chart>series>data"),S);var N=m.reduce((function(e,t){var n=Math.abs(e),a=Math.abs(t);return Math.max(n,a)}),0),M=k.reduce((function(e,t){var n=Math.abs(e),a=Math.abs(t);return Math.max(n,a)}),0);(0,T.Z)(e,"[tag:".concat(h,"]>area>text"),"PGA: ".concat(M.toFixed(5)," gal\n\n            PGV: ").concat(N.toFixed(5)," cm/s\n"))},i=0,l=["ehz","ehe","ehn"];i<l.length;i++)c();return e},F=n(6417),H=function(e){(0,i.Z)(n,e);var t=(0,l.Z)(n);function n(e){var a;return(0,s.Z)(this,n),(a=t.call(this,e)).prevTs=void 0,a.websocket=void 0,a.handleWebsocketOpen=function(){setTimeout((function(){W.ZP.success("Websocket \u8fde\u7ebf\u5df2\u7ecf\u5efa\u7acb")}),500)},a.handleWebsocketData=function(e){var t=JSON.parse(e.data),n=z(t,a.prevTs),r=O(a.state.areas,t,a.prevTs,180,a.state.adc,a.state.geophone);a.prevTs=t.ts,a.setState({banner:n,areas:r})},a.state={banner:{type:"warning",label:"\u6b63\u5728\u8fde\u63a5\u670d\u52a1\u5668",text:"\u8bf7\u7a0d\u7b49..."},areas:[{tag:"ehz",area:{label:"EHZ \u5782\u76f4\u5206\u91cf\u901a\u9053\u52a0\u901f\u5ea6",text:"PGA: \u6b63\u5728\u83b7\u53d6\u4e2d\nPGV: \u6b63\u5728\u83b7\u53d6\u4e2d"},chart:{backgroundColor:"#d97706",lineWidth:2,height:300,series:{type:"line",color:"#fff",data:[]}}},{tag:"ehe",area:{label:"EHE \u4e1c\u897f\u5206\u91cf\u901a\u9053\u52a0\u901f\u5ea6",text:"PGA: \u6b63\u5728\u83b7\u53d6\u4e2d\nPGV: \u6b63\u5728\u83b7\u53d6\u4e2d"},chart:{backgroundColor:"#10b981",lineWidth:2,height:300,series:{type:"line",color:"#fff",data:[]}}},{tag:"ehn",area:{label:"EHN \u5357\u5317\u65b9\u5411\u901a\u9053\u52a0\u901f\u5ea6",text:"PGA: \u6b63\u5728\u83b7\u53d6\u4e2d\nPGV: \u6b63\u5728\u83b7\u53d6\u4e2d"},chart:{backgroundColor:"#0ea5e9",lineWidth:2,height:300,series:{type:"line",color:"#fff",data:[]}}}],geophone:{ehz:.288,ehe:.288,ehn:.288},adc:{fullscale:5,resolution:24}},a.prevTs=0,a.websocket=null,a}return(0,c.Z)(n,[{key:"componentDidMount",value:function(){var e=(0,o.Z)((0,r.Z)().mark((function e(){var t,n,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,w.Z)({tag:"station"});case 2:if(!(t=e.sent).data){e.next=9;break}n=y(t),a=j(t),this.setState({adc:n,geophone:a}),e.next=10;break;case 9:return e.abrupt("return");case 10:this.websocket=P({tag:"socket",onData:this.handleWebsocketData,onOpen:this.handleWebsocketOpen});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.websocket&&(this.websocket.close(),this.websocket=null)}},{key:"render",value:function(){var e=this.state,t=e.areas,n=e.banner;return(0,F.jsxs)(v.Z,{children:[(0,F.jsx)(h.Z,{}),(0,F.jsx)(d.Z,{}),(0,F.jsxs)(f.Z,{children:[(0,F.jsx)(p.Z,{}),(0,F.jsx)(x.Z,(0,a.Z)({},n)),(0,F.jsx)(m.Z,{layout:"none",children:t.map((function(e,t){var n=e.area,r=e.chart;return(0,F.jsx)(b.Z,(0,a.Z)((0,a.Z)({},n),{},{children:(0,F.jsx)(k.Z,(0,a.Z)((0,a.Z)({},r),{},{zooming:!0,animation:!1,tickPrecision:.4,tickInterval:1e-4}))}),t)}))})]}),(0,F.jsx)(g.Z,{}),(0,F.jsx)(Z.Z,{}),(0,F.jsx)(W.x7,{position:"top-center"})]})}}]),n}(u.Component)}}]);