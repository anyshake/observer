"use strict";(self.webpackChunkobserver=self.webpackChunkobserver||[]).push([[967],{5664:function(e,t){t.Z=function(e,t){for(var n=[],a=0;a<e.length;a++)a?n.push((e[a]-e[a-1])/t):n.push(0);return n}},3148:function(e,t,n){var a=n(7762);t.Z=function(e,t){var n,r=[],o=(0,a.Z)(e);try{for(o.s();!(n=o.n()).done;){var s=n.value;r.push(s/t)}}catch(i){o.e(i)}finally{o.f()}return r}},8715:function(e,t,n){var a=n(7762);t.Z=function(e,t,n){var r,o=Math.pow(2,t-1),s=[],i=(0,a.Z)(e);try{for(i.s();!(r=i.n()).done;){var c=r.value;s.push(n/o*c)}}catch(l){i.e(l)}finally{i.f()}return s}},9350:function(e,t){t.Z=function(e){var t=new Date(e),n=t.getFullYear(),a=(t.getMonth()+1).toString().padStart(2,"0"),r=t.getDate().toString().padStart(2,"0"),o=t.getHours().toString().padStart(2,"0"),s=t.getMinutes().toString().padStart(2,"0"),i=t.getSeconds().toString().padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(r," ").concat(o,":").concat(s,":").concat(i)}},967:function(e,t,n){n.r(t),n.d(t,{default:function(){return Y}});var a=n(1413),r=n(4165),o=n(5861),s=n(5671),i=n(3144),c=n(136),l=n(9388),u=n(7313),h=n(3670),d=n(8669),p=n(501),v=n(5097),f=n(4656),b=n(284),g=n(318),w=n(19),Z=n(5608),k=n(1109),m=n(3676),x=n(2468),y=function(e){var t=e.data.adc;return{resolution:t.resolution,fullscale:t.fullscale}},S=function(e){var t=e.data.geophone;return{ehz:t.ehz,ehe:t.ehe,ehn:t.ehn}},W=n(1677),C=n(281),j=n(1061),z=function(e){var t=e.tag,n=e.onOpen,a=e.onData,r=e.onClose,o=e.onError;try{var s;if("ws"!==(null===(s=W.Z.find((function(e){return e.tag===t})))||void 0===s?void 0:s.type))throw new Error("non-websocket protocol is not supported");var i=(0,C.Z)(t),c="https:"===window.location.protocol?"wss:":"ws:",l=new WebSocket("".concat(c).concat((0,j.Z)()).concat(i));return l.onmessage=a,l.onopen=n||function(){},l.onclose=r||function(){},l.onerror=o||function(){},l}catch(u){return void(o&&o(new Event("error occurred")))}},D=n(6059),M=n(9350),E=function(e,t,n){var a=e||{ts:-1,ehz:0,ehe:0,ehn:0},r=a.ts,o=a.ehz,s=a.ehe,i=a.ehn,c=(1e3*((o.length+s.length+i.length)/3)/(r-(t||0))).toFixed(2);return-1===r&&o*i*s===0?{type:"error",label:{id:"views.realtime.banner.error.label"},text:{id:"views.realtime.banner.error.text"}}:{type:"success",label:{id:"views.realtime.banner.success.label",format:{sampleRate:c}},text:{id:"views.realtime.banner.success.text",format:{time:(0,M.Z)(r),scale:(null===n||void 0===n?void 0:n.name)||"Unknown"}}}},O=n(3148),T=n(3651),U=n(8715),F=n(7912),H=n(5664),_=n(5827),P=function(e,t,n,a,r,o,s){for(var i=t.ts,c=function(){for(var c,h,d=u[l],p=t.ehz,v=t.ehe,f=t.ehn,b=(p.length+v.length+f.length)/3,g=0!==n?i-n:1e3,w=g/b,Z=t[d],k=(0,U.Z)(Z,r.resolution,r.fullscale),m=(0,O.Z)(k,o[d]),x=(0,H.Z)(m,w/g),y=null===(c=e.find((function(e){return e.tag===d})))||void 0===c||null===(h=c.chart.series)||void 0===h?void 0:h.data,S=[],W=0;W<Z.length;W++)S.push([i-(b-W)*w,Z[W]]);var C=(0,T.Z)(y,S,a*b);(0,F.Z)(e,"[tag:".concat(d,"]>chart>series>data"),C);var j=m.reduce((function(e,t){var n=Math.abs(e),a=Math.abs(t);return Math.max(n,a)}),0),z=x.reduce((function(e,t){var n=Math.abs(e),a=Math.abs(t);return Math.max(n,a)}),0),D=_.Z.app_settings.scales.find((function(e){return e.property().value===s.value})),M=null===D||void 0===D?void 0:D.intensity(j,z);(0,F.Z)(e,"[tag:".concat(d,"]>area>text"),{id:"views.realtime.areas.".concat(d,".text"),format:{pga:z.toFixed(5),pgv:j.toFixed(5),intensity:"".concat(s.value," ").concat(M)}})},l=0,u=["ehz","ehe","ehn"];l<u.length;l++)c();return e},A=n(6135),G=n(7703),N=n(8146),V=n(8780),I=n(5590),J=n(6417),R=function(e){(0,c.Z)(n,e);var t=(0,l.Z)(n);function n(e){var a;return(0,s.Z)(this,n),(a=t.call(this,e)).prevTs=void 0,a.websocket=void 0,a.handleWebsocketOpen=function(){setTimeout((function(){var e=a.props.t;D.ZP.success(e("views.realtime.toasts.websocket_connected"))}),500)},a.handleWebsocketClose=function(){if(a.websocket&&a.websocket instanceof WebSocket){var e=E();a.setState({banner:e}),a.websocket=z({tag:"socket",onData:a.handleWebsocketData,onOpen:a.handleWebsocketOpen,onClose:a.handleWebsocketClose})}},a.handleWebsocketData=function(e){var t=a.state,n=t.adc,r=t.geophone,o=t.scale,s=JSON.parse(e.data),i=E(s,a.prevTs,o),c=P(a.state.areas,s,a.prevTs,180,n,r,o);a.prevTs=s.ts,a.setState({banner:i,areas:c})},a.state={banner:{type:"warning",label:{id:"views.realtime.banner.warning.label"},text:{id:"views.realtime.banner.warning.text"}},areas:[{tag:"ehz",area:{label:{id:"views.realtime.areas.ehz.label"},text:{id:"views.realtime.areas.ehz.text",format:{pga:"0.00000",pgv:"0.00000",intensity:"Unknown"}}},chart:{backgroundColor:"#d97706",lineWidth:1,height:300,series:{name:"EHZ",type:"line",color:"#f1f5f9",data:[]}}},{tag:"ehe",area:{label:{id:"views.realtime.areas.ehe.label"},text:{id:"views.realtime.areas.ehe.text",format:{pga:"0.00000",pgv:"0.00000",intensity:"Unknown"}}},chart:{backgroundColor:"#10b981",lineWidth:1,height:300,series:{name:"EHE",type:"line",color:"#f1f5f9",data:[]}}},{tag:"ehn",area:{label:{id:"views.realtime.areas.ehn.label"},text:{id:"views.realtime.areas.ehn.text",format:{pga:"0.00000",pgv:"0.00000",intensity:"Unknown"}}},chart:{backgroundColor:"#0ea5e9",lineWidth:1,height:300,series:{name:"EHN",type:"line",color:"#f1f5f9",data:[]}}}],geophone:{ehz:1,ehe:1,ehn:1},adc:{fullscale:1,resolution:1},scale:_.m.property()},a.websocket=null,a.prevTs=0,a}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){var e=(0,o.Z)((0,r.Z)().mark((function e(){var t,n,a,o,s,i,c,l,u,h,d,p;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.props.adc.adc,n=this.props.scale.scale,a=this.props.geophone.geophone,s=(o=a).ehz,i=o.ehe,c=o.ehn,-1!==t.resolution&&s*i*c!==0){e.next=20;break}return e.next=8,(0,x.Z)({tag:"station"});case 8:if(!(l=e.sent).data){e.next=17;break}a=S(l),t=y(l),u=this.props,h=u.updateADC,(d=u.updateGeophone)&&d(a),h&&h(t),e.next=20;break;case 17:return p=this.props.t,D.ZP.error(p("views.realtime.toasts.fetch_metadata_error")),e.abrupt("return");case 20:this.setState({adc:t,geophone:a,scale:n}),this.websocket=z({tag:"socket",onData:this.handleWebsocketData,onOpen:this.handleWebsocketOpen,onClose:this.handleWebsocketClose});case 22:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){var e;this.websocket instanceof WebSocket&&(null===(e=this.websocket)||void 0===e||e.close(),this.websocket={})}},{key:"render",value:function(){var e=this.state,t=e.areas,n=e.banner;return(0,J.jsxs)(f.Z,{children:[(0,J.jsx)(h.Z,{}),(0,J.jsx)(d.Z,{}),(0,J.jsxs)(p.Z,{children:[(0,J.jsx)(v.Z,{}),(0,J.jsx)(g.Z,(0,a.Z)({},n)),(0,J.jsx)(k.Z,{layout:"none",children:t.map((function(e,t){var n=e.area,r=e.chart;return(0,J.jsx)(Z.Z,(0,a.Z)((0,a.Z)({},n),{},{children:(0,J.jsx)(m.Z,(0,a.Z)((0,a.Z)({},r),{},{tooltip:!0,zooming:!0,animation:!1,tickPrecision:1,tickInterval:10}))}),t)}))})]}),(0,J.jsx)(b.Z,{}),(0,J.jsx)(w.Z,{}),(0,J.jsx)(D.x7,{position:"top-center"})]})}}]),n}(u.Component),Y=(0,A.$j)(V.Z,{updateGeophone:N.V,updateADC:G.V})((0,I.Zh)()(R))}}]);