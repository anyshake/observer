"use strict";(self.webpackChunkobserver=self.webpackChunkobserver||[]).push([[311],{5664:function(e,t){t.Z=function(e,t){for(var n=[],a=0;a<e.length;a++)a?n.push((e[a]-e[a-1])/t):n.push(0);return n}},3148:function(e,t,n){var a=n(7762);t.Z=function(e,t){var n,o=[],r=(0,a.Z)(e);try{for(r.s();!(n=r.n()).done;){var c=n.value;o.push(c/t)}}catch(s){r.e(s)}finally{r.f()}return o}},8715:function(e,t,n){var a=n(7762);t.Z=function(e,t,n){var o,r=Math.pow(2,t-1),c=[],s=(0,a.Z)(e);try{for(s.s();!(o=s.n()).done;){var i=o.value;c.push(n/r*i)}}catch(u){s.e(u)}finally{s.f()}return c}},1370:function(e,t){t.Z=function(e,t,n){try{var a=localStorage.getItem(e);if(null!==a)return n?JSON.parse(a):a}catch(o){localStorage.setItem(e,n?JSON.stringify(t):t)}return t}},9350:function(e,t){t.Z=function(e){var t=new Date(e),n=t.getFullYear(),a=(t.getMonth()+1).toString().padStart(2,"0"),o=t.getDate().toString().padStart(2,"0"),r=t.getHours().toString().padStart(2,"0"),c=t.getMinutes().toString().padStart(2,"0"),s=t.getSeconds().toString().padStart(2,"0");return"".concat(n,"-").concat(a,"-").concat(o," ").concat(r,":").concat(c,":").concat(s)}},3311:function(e,t,n){n.r(t),n.d(t,{default:function(){return $}});var a=n(1413),o=n(4165),r=n(5861),c=n(5671),s=n(3144),i=n(136),u=n(7277),l=n(7313),h=n(922),p=n(3534),d=n(501),f=n(5097),v=n(4656),g=n(284),Z=n(318),b=n(19),k=n(5608),x=n(1109),w=n(3676),y=n(2468),m=function(e){var t=e.data.adc;return{resolution:t.resolution,fullscale:t.fullscale}},S=function(e){var t=e.data.geophone;return{ehz:t.ehz,ehe:t.ehe,ehn:t.ehn}},W=n(1677),j=n(281),C=n(1061),P=function(e){var t=e.tag,n=e.onOpen,a=e.onData,o=e.onClose,r=e.onError;try{var c;if("ws"!==(null===(c=W.Z.find((function(e){return e.tag===t})))||void 0===c?void 0:c.type))throw new Error("non-websocket protocol is not supported");var s=(0,j.Z)(t),i="https:"===window.location.protocol?"wss:":"ws:",u=new WebSocket("".concat(i).concat((0,C.Z)()).concat(s));return u.onmessage=a,u.onopen=n||function(){},u.onclose=o||function(){},u.onerror=r||function(){},u}catch(l){return void(r&&r(new Event("error occurred")))}},D=n(6059),E=n(9350),z=function(e,t,n){var a=e||{ts:-1,ehz:0,ehe:0,ehn:0},o=a.ts,r=a.ehz,c=a.ehe,s=a.ehn,i=(r.length+c.length+s.length)/3;return-1===o&&r*s*c===0?{type:"error",label:"\u8fde\u7ebf\u65ad\u5f00",text:"\u6b63\u5728\u5c1d\u8bd5\u91cd\u65b0\u8fde\u7ebf\uff0c\u8bf7\u7a0d\u5019"}:{type:"success",label:"\u8fde\u63a5\u6210\u529f\uff1a\u5b9e\u9645\u91c7\u6837\u7387 ".concat((1e3*i/(o-(t||0))).toFixed(2)," Sps"),text:"\u5f53\u524d\u9707\u5ea6\u6807\u51c6\u4e3a".concat((null===n||void 0===n?void 0:n.name)||"\u672a\u77e5\u6807\u51c6","\n\u6570\u636e\u6700\u540e\u66f4\u65b0\u4e8e ").concat((0,E.Z)(o))}},G=n(3148),M=n(3651),O=n(8715),H=n(7912),A=n(5664),T=n(5827),V=function(e,t,n,a,o,r,c){for(var s=t.ts,i=function(){for(var i,h,p=l[u],d=t.ehz,f=t.ehe,v=t.ehn,g=(d.length+f.length+v.length)/3,Z=0!==n?s-n:1e3,b=Z/g,k=(0,O.Z)(t[p],o.resolution,o.fullscale),x=(0,G.Z)(k,r[p]),w=(0,A.Z)(x,b/Z),y=null===(i=e.find((function(e){return e.tag===p})))||void 0===i||null===(h=i.chart.series)||void 0===h?void 0:h.data,m=[],S=0;S<w.length;S++)m.push([s-(g-S)*b,w[S]]);var W=(0,M.Z)(y,m,a*g);(0,H.Z)(e,"[tag:".concat(p,"]>chart>series>data"),W);var j=x.reduce((function(e,t){var n=Math.abs(e),a=Math.abs(t);return Math.max(n,a)}),0),C=w.reduce((function(e,t){var n=Math.abs(e),a=Math.abs(t);return Math.max(n,a)}),0),P=T.Z.app_settings.scales.find((function(e){return e.property().value===c.value})),D=null===P||void 0===P?void 0:P.intensity(j,C);(0,H.Z)(e,"[tag:".concat(p,"]>area>text"),"PGA\uff1a".concat(C.toFixed(5)," gal\n\n            PGV\uff1a").concat(j.toFixed(5)," cm/s\n\n            \u9707\u5ea6\uff1a").concat(c.value," \u9707\u5ea6 ").concat(D))},u=0,l=["ehz","ehe","ehn"];u<l.length;u++)i();return e},N=n(1370),F=n(6135),I=n(7703),J=n(8146),U=n(6417),Y=function(e){(0,i.Z)(n,e);var t=(0,u.Z)(n);function n(e){var a;return(0,c.Z)(this,n),(a=t.call(this,e)).prevTs=void 0,a.websocket=void 0,a.handleWebsocketOpen=function(){setTimeout((function(){D.ZP.success("Websocket \u8fde\u7ebf\u5df2\u7ecf\u5efa\u7acb")}),500)},a.handleWebsocketClose=function(){var e=z();a.setState({banner:e}),a.websocket=P({tag:"socket",onData:a.handleWebsocketData,onOpen:a.handleWebsocketOpen,onClose:a.handleWebsocketClose})},a.handleWebsocketData=function(e){var t=a.state,n=t.adc,o=t.geophone,r=t.scale,c=JSON.parse(e.data),s=z(c,a.prevTs,r),i=V(a.state.areas,c,a.prevTs,180,n,o,r);a.prevTs=c.ts,a.setState({banner:s,areas:i})},a.state={banner:{type:"warning",label:"\u6b63\u5728\u8fde\u63a5\u670d\u52a1\u5668",text:"\u8bf7\u7a0d\u7b49..."},areas:[{tag:"ehz",area:{label:"EHZ \u901a\u9053\u52a0\u901f\u5ea6",text:"PGA\uff1a\u6b63\u5728\u83b7\u53d6\u4e2d\nPGV\uff1a\u6b63\u5728\u83b7\u53d6\u4e2d\n\u9707\u5ea6\uff1a\u6b63\u5728\u83b7\u53d6\u4e2d"},chart:{backgroundColor:"#d97706",lineWidth:1,height:300,series:{name:"EHZ",type:"line",color:"#f1f5f9",data:[]}}},{tag:"ehe",area:{label:"EHE \u901a\u9053\u52a0\u901f\u5ea6",text:"PGA\uff1a\u6b63\u5728\u83b7\u53d6\u4e2d\nPGV\uff1a\u6b63\u5728\u83b7\u53d6\u4e2d\n\u9707\u5ea6\uff1a\u6b63\u5728\u83b7\u53d6\u4e2d"},chart:{backgroundColor:"#10b981",lineWidth:1,height:300,series:{name:"EHE",type:"line",color:"#f1f5f9",data:[]}}},{tag:"ehn",area:{label:"EHN \u901a\u9053\u52a0\u901f\u5ea6",text:"PGA\uff1a\u6b63\u5728\u83b7\u53d6\u4e2d\nPGV\uff1a\u6b63\u5728\u83b7\u53d6\u4e2d\n\u9707\u5ea6\uff1a\u6b63\u5728\u83b7\u53d6\u4e2d"},chart:{backgroundColor:"#0ea5e9",lineWidth:1,height:300,series:{name:"EHN",type:"line",color:"#f1f5f9",data:[]}}}],geophone:{ehz:.288,ehe:.288,ehn:.288},adc:{fullscale:5,resolution:24},scale:T.m.property()},a.prevTs=0,a.websocket=null,a}return(0,s.Z)(n,[{key:"componentDidMount",value:function(){var e=(0,r.Z)((0,o.Z)().mark((function e(){var t,n,a,r,c,s,i,u,l,h,p,d;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(0,N.Z)("scale",T.m.property(),!0),n=this.props.adc.adc,a=this.props.geophone.geophone,r=n.resolution,s=(c=a).ehz,i=c.ehe,u=c.ehn,-1!==r&&s*i*u!==0){e.next=20;break}return e.next=8,(0,y.Z)({tag:"station"});case 8:if(!(l=e.sent).data){e.next=17;break}n=m(l),a=S(l),h=this.props,p=h.updateADC,(0,h.updateGeophone)(a),p(n),e.next=20;break;case 17:return d="\u53d6\u5f97\u6d4b\u7ad9\u8d44\u8baf\u65f6\u53d1\u751f\u9519\u8bef\uff0c\u529f\u80fd\u65e0\u6cd5\u4f7f\u7528",D.ZP.error(d),e.abrupt("return",Promise.reject(d));case 20:this.setState({adc:n,geophone:a,scale:t}),this.websocket=P({tag:"socket",onData:this.handleWebsocketData,onOpen:this.handleWebsocketOpen,onClose:this.handleWebsocketClose});case 22:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.websocket&&(this.websocket.close(),this.websocket=null)}},{key:"render",value:function(){var e=this.state,t=e.areas,n=e.banner;return(0,U.jsxs)(v.Z,{children:[(0,U.jsx)(h.Z,{}),(0,U.jsx)(p.Z,{}),(0,U.jsxs)(d.Z,{children:[(0,U.jsx)(f.Z,{}),(0,U.jsx)(Z.Z,(0,a.Z)({},n)),(0,U.jsx)(x.Z,{layout:"none",children:t.map((function(e,t){var n=e.area,o=e.chart;return(0,U.jsx)(k.Z,(0,a.Z)((0,a.Z)({},n),{},{children:(0,U.jsx)(w.Z,(0,a.Z)((0,a.Z)({},o),{},{tooltip:!0,zooming:!0,animation:!1,tickPrecision:.4,tickInterval:1e-4}))}),t)}))})]}),(0,U.jsx)(g.Z,{}),(0,U.jsx)(b.Z,{}),(0,U.jsx)(D.x7,{position:"top-center"})]})}}]),n}(l.Component),$=(0,F.$j)((function(e){return(0,a.Z)({},e)}),{updateGeophone:J.V,updateADC:I.V})(Y)}}]);